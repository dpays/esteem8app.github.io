<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html">
<link rel="import" href="../iron-a11y-keys/iron-a11y-keys.html">
<link rel="import" href="../iron-behaviors/iron-button-state.html">
<link rel="import" href="../iron-behaviors/iron-control-state.html">
<link rel="import" href="../iron-form-element-behavior/iron-form-element-behavior.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-validatable-behavior/iron-validatable-behavior.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-menu-button/paper-menu-button.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-ripple/paper-ripple.html">
<link rel="import" href="../paper-styles/default-theme.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu-icons.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu-shared-styles.html">
<link rel="import" href="paper-tags-input.html">
<link rel="import" href="paper-tags-behavior.html">

</head><body><dom-module id="paper-tags-dropdown">
  <template>
    <style include="paper-dropdown-menu-shared-styles">
    :host: {
      display: block;
    }
    
    #filterCt {
      color: var(--default-primary-color);
      padding: 2px 8;
    }

    paper-menu {
      min-width: 150px;
      
      @apply(--paper-menu);
    }

    </style>
    
    <div role="button"></div>
    <paper-menu-button id="menuButton" vertical-align="[[verticalAlign]]" horizontal-align="[[horizontalAlign]]" vertical-offset="[[_computeMenuVerticalOffset(noLabelFloat)]]" disabled="[[disabled]]" no-animations="[[noAnimations]]" __on-iron-select="_onSelectionChange" __on-iron-deselect="_onSelectionChange" opened="{{opened}}">
      <div class="dropdown-trigger">
        <paper-ripple></paper-ripple>
        
        <iron-a11y-keys id="a11y" target="[[keyTarget]]" keys="[[_computeKeys()]]" on-keys-pressed="_onAscii"></iron-a11y-keys>
        <paper-tags-input max-tags="[[maxTags]]" prevent-remove-tag="[[preventRemoveTag]]" min-tags="[[minTags]]" id="tagInput" value-array="{{valueArray}}" on-tap="_onTagTap" tag-tpl="[[tag-tpl]]" items="[[tagItems]]" value="{{value}}" icon="[[icon]]" item-class="[[itemClass]]" class-accessor="[[classAccessor]]" label-accessor="[[labelAccessor]]" icon-accessor="[[iconAccessor]]" id-accessor="[[idAccessor]]" invalid="[[invalid]]" readonly="[[readonly]]" disabled="[[disabled]]" placeholder="[[placeholder]]" error-message="[[errorMessage]]" label="[[label]]" show-counter="[[showCounter]]">
          <iron-icon icon="paper-dropdown-menu:arrow-drop-down" suffix=""></iron-icon>
        </paper-tags-input>
      </div>
      <paper-menu class="dropdown-content" selected-values="{{valueArray}}" attr-for-selected="name" multi="">
        <div id="filterCt" hidden$="[[!searchString]]">
          <span>filter:  {{searchString}}</span>
        </div>
        <template is="dom-repeat" items="{{items}}" filter="{{_computeFilter(searchString)}}">
          <paper-item name="[[_computeItemValue(item, idAccessor)]]">[[_computeItemLabel(item, labelAccessor)]]</paper-item>
        </template>
      </paper-menu>
      <content id="content" select=".dropdown-content"></content>
    </paper-menu-button>
  </template>
  <script>!function(){"use strict";Polymer({is:"paper-tags-dropdown",behaviors:[Polymer.IronButtonState,Polymer.IronControlState,Polymer.IronFormElementBehavior,Polymer.IronValidatableBehavior,Polymer.PaperTagsBehavior],properties:{searchString:{type:String,value:""},items:{type:Array},tagItems:{type:Array},showCounter:String,maxTags:Number,minTags:Number,tagTpl:Object,keyTarget:{type:Object,value:function(){return this.$.tagInput}},selectedItemLabel:{type:String,notify:!0,readOnly:!0},label:{type:String},placeholder:{type:String},errorMessage:{type:String},opened:{type:Boolean,notify:!0,value:!1,observer:"_openedChanged"},noLabelFloat:{type:Boolean,value:!1,reflectToAttribute:!0},alwaysFloatLabel:{type:Boolean,value:!1},noAnimations:{type:Boolean,value:!1},horizontalAlign:{type:String,value:"right"},verticalAlign:{type:String,value:"top"}},listeners:{tap:"_onTap"},keyBindings:{"up down":"open",esc:"close"},hostAttributes:{role:"combobox","aria-autocomplete":"none","aria-haspopup":"true"},observers:["_observeItems(items.splices)"],_observeItems:function(e){this._observeValueArray()},_isUpdatingValueArray:0,_observeValueArray:function(){if(this._isUpdatingValueArray++,this._isUpdatingValueArray<2&&this.items){var e={};if(!this.valueArray||!this.valueArray.length)return this.set("tagItems",[]),this._isUpdatingValueObject||this.set("valueObject",null),this._setValueJoin(""),void this._isUpdatingValueArray--;this.valueArray.forEach(function(t){e[t]=!0}),this.set("tagItems",this.items.filter(function(e){return this.valueArray.indexOf(e[this.idAccessor||e]+"")>-1},this)),this._isUpdatingValueObject||this.set("valueObject",e),this._setValueJoin(this.valueArray.join(", "))}this._isUpdatingValueArray--},ready:function(){this.$.menuButton.ignoreSelect=!0,this.$.tagInput.allowAdd=!1,this.valueObject&&!this.valueArray&&this.set("valueArray",Object.keys(this.valueObject))},attached:function(){var e=this.contentElement;e&&e.selectedItem&&this._setSelectedItem(e.selectedItem)},get contentElement(){return Polymer.dom(this.$.content).getDistributedNodes()[0]},open:function(){this.$.menuButton.open()},close:function(){this.$.menuButton.close()},_computeItemValue:function(e,t){return(e[t]||e)+""},_computeItemLabel:function(e,t){var n=Polymer.Base._getPathParts(t);if(1===n.length)return e[t]||e;var r=e;return n.forEach(function(e){r&&(r=r[e])}),r},_computeKeys:function(){for(var e=" ",t=48;t<=126;t++)e+=String.fromCharCode(t)+" ";return e+="backspace "},_computeFilter:function(e){e=e.toLowerCase();var t=this.labelAccessor,n=Polymer.Base._getPathParts(t);return 1===n.length?function(n){return n[t]&&n[t].toLowerCase().indexOf(e)>-1}:function(t){var r=t;return n.forEach(function(e){r&&(r=r[e])}),r&&r.toLowerCase().indexOf(e)>-1}},_onTap:function(e){Polymer.Gestures.findOriginalTarget(e)===this&&this.open()},_onTagTap:function(e){(e.detail.isRemoved||"input"===e.srcElement.localName)&&e.stopPropagation()},_onAscii:function(e){this.open(),this.async(function(){this.set("searchString",this.$.tagInput.value)},30)},_computeMenuVerticalOffset:function(e){return e?-4:8},_getValidity:function(e){return this.disabled||!this.required||this.required&&!!this.value},_openedChanged:function(){var e=this.opened?"true":"false",t=this.contentElement;t&&t.setAttribute("aria-expanded",e)}})}();</script>
</dom-module>
</body></html>
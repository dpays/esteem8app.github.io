<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">

<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">

<link rel="import" href="../components/my-icons.html">
<link rel="import" href="../api/github/get-repository-files.html">
<link rel="import" href="../shared-styles.html">
</head><body><dom-module id="github-repository-file-list">

    <template>

        <style include="shared-styles">

            #fileList {
                max-height: 300px;
                overflow: auto;
            }

            paper-listbox {
                --paper-listbox-background-color: transparent;
                --paper-listbox-color: inerhite;
                color: var(--app-background-primary-text-color);
            }

            iron-icon {
                color: var(--app-background-secondary-text-color);
                margin-right: 12px;
            }

        </style>

        <get-repository-files url="[[_url]]" files="{{_files}}">
        </get-repository-files>

        <div id="folderBack">
            <paper-item id="back" on-tap="_toBackFolder" hidden="[[_backHidden]]">
                <iron-icon icon="my-icons:arrow-back"></iron-icon>
            </paper-item>
        </div>

        <div id="fileList">
            <paper-listbox selected="{{selectedFile}}" attr-for-selected="file">

                <template is="dom-repeat" items="[[_files]]" sort="[[_sortFileList]]">
                    <paper-item file="[[item]]">
                        <iron-icon icon="my-icons:[[_computeFileIcon(item.name, item.type)]]"></iron-icon>
                        [[item.name]]
                    </paper-item>
                </template>

            </paper-listbox>
        </div>

    </template>
</dom-module>

<script>!function(){"use strict";Polymer({is:"github-repository-file-list",properties:{repository:{type:String},selectedFile:{type:Object,notify:!0,observer:"_selectNewFolder"},_url:{type:String},_files:{type:Array,observer:"_selectDefaultFile"},_backHidden:{type:Boolean}},observers:["_computeFilesUrl(repository)"],ready:function(){this.$.back.addEventListener("tap",this._toBackFolder.bind(this)),this._backHidden=!0},_computeFilesUrl:function(e){if(""!==e){var t=e.replace("https://github.com","https://api.github.com/repos");t+="/contents/",this._url=t}},_sortFileList:function(e,t){return e.type==t.type?e.name<t.name:"dir"==e.type&&"file"==t.type?-1:1},_selectDefaultFile:function(){for(var e=this._files,t=0;t<e.length;t++){var i=e[t].name;i=i.toLowerCase(),i.includes("readme.md")&&this.set("selectedFile",e[t])}},_selectNewFolder:function(){"dir"==this.selectedFile.type&&(this._url=this.selectedFile.url,this._backHidden=!1)},_toBackFolder:function(){console.log(this._url);var e=this._url.split("/");"contents"==e[e.length-1]?this._backHidden=!0:(e.pop(),this._url=e.join("/"))},_computeFileIcon:function(e,t){switch(t){case"dir":return"folder";case"file":return e.includes(".md")?"text-file":e.includes(".html")||e.includes(".js")||e.includes(".css")||e.includes(".json")?"code":"file"}}})}();</script>
</body></html>
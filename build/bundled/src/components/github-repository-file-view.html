<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">

<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../components/html-echo.html">
<link rel="import" href="../components/my-icons.html">
<link rel="import" href="../components/prism-render.html">
<link rel="import" href="../api/other/url-get-file.html">
<link rel="import" href="../shared-styles.html">
</head><body><dom-module id="github-repository-file-view">

    <template>

        <style include="shared-styles">

            .right {
                position: absolute;
                right: 4px;
                top: 4px;
            }

            .currentFileInfo {
                color: var(--app-secondary-color);
                border-top: 1px solid var(--app-background-secondary-text-color);
            }

            .currentFile {
                border-top: 1px solid var(--app-background-secondary-text-color);
                padding: 8px;
                overflow: auto;
            }

            marked-element a{
                color: var(--app-background-primary-text-color) !important;
            }

        </style>

        <url-get-file url="[[file.download_url]]" response-text="{{_fileText}}"></url-get-file>

        <a id="downloadFileA" href="" download=""></a>

        <paper-item class="currentFileInfo">

            <iron-icon icon="my-icons:[[_computeFileIcon(file.name, file.type)]]"></iron-icon>
            [[file.name]]
            <div class="right" hidden="[[_isFileDir]]">
                <paper-icon-button id="githubLinkDownload" on-tap="_downloadFile()" icon="my-icons:download">
                </paper-icon-button>
                <paper-icon-button id="githubLinkHistory" on-tap="_openFileInGithub()" open-type="commits" icon="my-icons:history">
                </paper-icon-button>
                <paper-icon-button id="githubLinkView" on-tap="_openFileInGithub()" open-type="blob" icon="my-icons:link">
                </paper-icon-button>
                <paper-icon-button id="githubLinkEdit" on-tap="_openFileInGithub()" open-type="edit" icon="my-icons:edit">
                </paper-icon-button>
            </div>
        </paper-item>

        <div class="currentFile">
            <template is="dom-if" if="[[_isFileMarkdown]]">
                <html-echo html="[[_fileText]]"></html-echo>
            </template>

            <template is="dom-if" if="[[_isFileCode]]">
                <prism-render code="[[_fileText]]"></prism-render>
            </template>

            <template is="dom-if" if="[[_isFileImage]]">
                <img src="[[file.download_url]]">
            </template>
        </div>


    </template>
</dom-module>

<script>!function(){"use strict";Polymer({is:"github-repository-file-view",properties:{file:{type:Object,observer:"_computeFileType"},fileUrl:{type:String,observer:"_createFileObject"},_fileText:{type:Object},_isFileMarkdown:{type:Boolean},_isFileCode:{type:Boolean,observer:"_renderCode"},_isFileDir:{type:Boolean},_isFileImage:{type:Boolean}},ready:function(){this.$.githubLinkEdit.addEventListener("tap",this._openFileInGithub.bind(this)),this.$.githubLinkHistory.addEventListener("tap",this._openFileInGithub.bind(this)),this.$.githubLinkView.addEventListener("tap",this._openFileInGithub.bind(this)),this.$.githubLinkDownload.addEventListener("tap",this._downloadFile.bind(this))},_createFileObject:function(){var e={},i=this.fileUrl.replace("github.com","raw.githubusercontent.com").replace("/blob","");e.html_url=this.fileUrl,e.download_url=i,e.name=/((?:[\. %a-zA-Z0-9-]+)?.\w+)$/gm.exec(i)[0],e.type="file",this.file=e,this._computeFileType()},_downloadFile:function(){var e=this.$.downloadFileA;e.setAttribute("href",this.file.download_url),e.setAttribute("download",this.file.name),e.click()},_computeFileType:function(){this._isFileMarkdown="text-file"==this._computeFileIcon(this.file.name),this._isFileImage="image"==this._computeFileIcon(this.file.name),this._isFileCode="code"==this._computeFileIcon(this.file.name),this._isFileDir="folder"==this._computeFileIcon(this.file.name,this.file.type)},_openFileInGithub:function(e){var i=Polymer.dom(e).localTarget.getAttribute("open-type")||"blob",t=this.file.html_url;t=t.replace("blob",i),window.open(t)},_computeFileIcon:function(e,i){var i=i||"file";switch(i){case"dir":return"folder";case"file":return e.includes(".md")?"text-file":e.includes(".html")||e.includes(".js")||e.includes(".css")||e.includes(".json")?"code":e.includes(".jpg")||e.includes(".jpeg")||e.includes(".png")||e.includes(".gif")||e.includes(".svg")?"image":"file"}}})}();</script>
</body></html>
<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-out-animation.html">

<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">

<link rel="import" href="../components/my-icons.html">
<link rel="import" href="../components/product-card.html">
<link rel="import" href="../components/html-echo.html">

<link rel="import" href="../dialogs/store-dialog.html">
<link rel="import" href="../dialogs/manage-categories-dialog.html">
<link rel="import" href="../dialogs/product-content.html">
<link rel="import" href="../dialogs/product-edit-content.html">
<link rel="import" href="../dialogs/select-category-dialog.html">

<link rel="import" href="../shared-styles.html">

</head><body><dom-module id="page-products">

    <template>

        <style include="shared-styles">

            /* GENERAL */
            :host {
                min-height: calc(100% - 16px);
                margin: 0;
                position: absolute;
                width: 100%;
                margin-top: -16px;
                padding-top: 16px;
                padding-bottom: 16px;
                display: block;
                background-color: var(--app-primary-background-color);
                overflow: hidden;
            }

            #productsList {
                overflow: auto !important;
                max-height: calc(100vh - 116px) !important;
            }

            #productOptionToolbar {
                background-color: var(--app-dark-primary-color);
                color: var(--app-primary-text-color);
                width: 100%;
            }

            .floatingToolbarTitle div {
                display: inline;
            }

            #mainToolbar {
                z-index: 5;
            }

            .mainToolbar .bottom div {
                display: inline;
            }

            .mainToolbar .bottom div[hidden] {
                display: none;
            }

            .dark-primary {
                text-align: right;
                width: 100%;
            }

            #products {
                margin-top: 128px;
            }

            .products-cards {
                @apply(--layout-horizontal);
                @apply(--layout-wrap);
            }

            product-card {
                background-color: rgba(128, 128, 128, 0);
                transition: background-color ease-out .1s;
            }

            product-card.iron-selected {
                background-color: rgba(128, 128, 128, 0.4);
                transition: background-color ease-in .1s;
            }

            #addProductFab {
                background-color: var(--app-secondary-color);
                color: var(--app-secondary-text-color);
                position: fixed;
                bottom: 16px;
                right: 16px;
                z-index: 4;
            }

            paper-dialog {
                background-color: var(--app-secondary-background-color);
                color: var(--app-background-primary-text-color)
            }

            paper-dialog .buttons paper-button {
                color: var(--app-secondary-color);
            }

            #viewProductDialog .dialog-title {
                display: inline;
            }

            .toggle {
                height: 64px;
                line-height: 64px;
            }

            .toggle paper-toggle-button {
                float: right;
                margin-top: 18px;
            }

            paper-toggle-button {
                --paper-toggle-button-checked-bar-color: var(--app-secondary-color);
                --paper-toggle-button-checked-button-color:  var(--app-secondary-color);
                --paper-toggle-button-checked-ink-color:  var(--app-secondary-color);
            }

            paper-input, paper-tags-input, paper-textarea {
                --paper-input-container-focus-color: var(--app-secondary-color);
                --paper-input-container-input-color: var(--app-background-primary-text-color);
                --paper-input-container-color: var(--app-background-secondary-text-color);
            }

            paper-tags, paper-tags-input {
                --paper-tag-margin: 4px;
                --paper-tag-focus-color: var(--app-secondary-color);
                --paper-tag-text-color: var(--app-background-primary-text-color);
                --paper-tags-item: {
                    padding-left: 8px !important;
                    color: var(--app-secondary-color) !important;
                };
            }

            .closeViewButton {
                color: var(--app-background-primary-text-color);
                position: absolute;
                right: 0;
                top: 0;
                padding: 8px !important;
                margin: 16px;
            }

            #openEditProductButton {
                padding: 8px;
            }

            #noProductText {
                text-align: center;
                width: 100%;
                padding-top: 36px;
                color: var(--app-background-primary-text-color);
            }


        </style>

        <store-dialog id="storeDialog" favorite-categories="{{favoriteCategories}}" favorite-products="{{favoriteProducts}}" manual-orders-history="{{manualOrdersHistory}}">

        </store-dialog>

        <select-category-dialog id="selectCategoryDialog" selected-category="{{query}}" favorite-categories="{{favoriteCategories}}" is-manage-category-dialog-opened="{{_isManageCategoryDialogOpened}}">
        </select-category-dialog>

        
        <paper-toolbar id="mainToolbar" class="mainToolbar medium-tall">

            <paper-icon-button icon="my-icons:menu" id="toggleDrawerMenu" on-tap="_openDrawer()">
            </paper-icon-button>
            <div id="floatingToolbar" on-tap="_openSelectCategoryDialog()" class="floatingToolbar">
                <span class="floatingToolbarTitle">
                    <div>/[[query]]</div>
                </span>
            </div>

            <paper-icon-button id="openStoreDialogButton" on-tap="_openStoreDialog()" icon="my-icons:store">
            </paper-icon-button>

            <div class="bottom right dark-primary">

                <div hidden="[[!_multipleSelected(_selectedProductsId.length)]]">
                    <paper-icon-button id="openEditMultipleProductButton" on-tap="_openEditProductDialog()" icon="my-icons:edit">
                    </paper-icon-button>
                </div>

                <div hidden="[[!_multipleSelected(_selectedProductsId.length)]]">
                    <paper-icon-button id="copyProductLinkButton" on-tap="_copyFileLink()" icon="my-icons:copy">
                    </paper-icon-button>
                </div>

                <div hidden="[[!_multipleSelected(_selectedProductsId.length)]]">
                    <paper-icon-button id="openConfirmationDeleteProductButton" on-tap="_openConfirmationRemoveProductsDialog()" icon="my-icons:delete">
                    </paper-icon-button>
                </div>

            </div>
        </paper-toolbar>

        
        <paper-dialog id="multipleEditIndexDialog" entry-animation="fade-in-animation" exit-animation="fade-out-animation" with-backdrop="">

            <h2>Multiple edit</h2>

            <paper-input label="Stock" type="number" value="{{_multipleEdit.stockChange}}">
            </paper-input>

            <span>Increase or decrease stock.</span>

            <div class="toggle">
                <span>Share product</span>
                <paper-toggle-button checked="{{_multipleEdit.shareProduct}}"></paper-toggle-button>
            </div>

            <div class="buttons">
                <paper-button dialog-dismiss="">
                    Cancel
                </paper-button>
                <paper-button dialog-confirm="" autofocus="" id="makeMultipleEditButton" on-tap="_makeMultipleEdit()">
                    Yes
                </paper-button>
            </div>

        </paper-dialog>

        
        <paper-dialog id="confirmationRemoveProductsDialog" entry-animation="fade-in-animation" exit-animation="fade-out-animation" with-backdrop="">

            <h2>Confirmation</h2>
            <p>Remove
                <span class="secondary-color">[[_selectedProductsId.length]]</span>
                products from favorite ?
            </p>

            <div class="buttons">
                <paper-button dialog-dismiss="">
                    Cancel
                </paper-button>
                <paper-button dialog-confirm="" autofocus="" id="deleteProductButton" on-tap="_deleteProduct()">
                    Yes
                </paper-button>
            </div>
        </paper-dialog>

        
        <manage-categories-dialog id="manageCategoriesDialog" opened="{{_isManageCategoryDialogOpened}}" categories="{{favoriteCategories}}" favorite-shared-categories="{{favoriteSharedCategories}}">
        </manage-categories-dialog>

        
        <paper-dialog id="addProductDialog" class="bigDialog withBottomAction" entry-animation="fade-in-animation" exit-animation="fade-out-animation" with-backdrop="">

            <h2>Add an product</h2>

            <paper-icon-button class="closeViewButton" icon="my-icons:close" dialog-dismiss="">
            </paper-icon-button>

            <div class="scrollable">

                <product-edit-content product="{{_currentProduct}}">
                </product-edit-content>

            </div>

            <div class="buttons">
                <paper-button dialog-dismiss="">
                    Cancel
                </paper-button>
                <paper-button dialog-confirm="" autofocus="" id="addProductButton" on-tap="_addProduct()">
                    Add
                </paper-button>
            </div>
        </paper-dialog>

        
        <paper-dialog id="editProductDialog" class="bigDialog withBottomAction">

            <h2>Edit an product</h2>

            <paper-icon-button class="closeViewButton" icon="my-icons:close" dialog-dismiss="">
            </paper-icon-button>

            <div class="scrollable">

                <product-edit-content product="{{_currentProduct}}">
                </product-edit-content>

            </div>

            <div class="buttons">
                <paper-button dialog-dismiss="">
                    Cancel
                </paper-button>
                <paper-button dialog-confirm="" autofocus="" id="saveProductButton" on-tap="_saveProduct()">
                    Save
                </paper-button>
            </div>
        </paper-dialog>

        
        <paper-dialog id="viewProductDialog" class="bigDialog" entry-animation="fade-in-animation" exit-animation="fade-out-animation" with-backdrop="">

            <h2 class="dialog-title">[[_currentProduct.name]]</h2>

            <paper-icon-button icon="my-icons:edit" id="openEditProductButton" on-tap="_openEditProductDialog()">
            </paper-icon-button>

            <paper-icon-button class="closeViewButton" icon="my-icons:close" dialog-dismiss="">
            </paper-icon-button>

            <div class="scrollable">
                <product-content product="{{_currentProduct}}"></product-content>
            </div>

        </paper-dialog>

        <div id="products">

            <template is="dom-if" if="[[!favoriteProducts.length]]">
                <h2 id="noProductText">You don't have any products</h2>
            </template>

            <template is="dom-if" if="[[favoriteProducts.length]]">
                <div class="product-cards">
                    <template is="dom-repeat" items="[[favoriteProducts]]" filter="{{computeFilter(query)}}">
                        <product-card product="[[item]]" product-id="[[item.id]]" action="{{_action}}" selected-products="{{_selectedProductsId}}">
                        </product-card>
                    </template>
                </div>
            </template>

        </div>

        <paper-fab id="addProductFab" on-tap="_openAddProductDialog()" icon="my-icons:add">
        </paper-fab>

    </template>
</dom-module>

<script>Polymer({is:"page-products",properties:{settings:{type:Object},favoriteProducts:{type:Array,notify:!0},favoriteSharedProducts:{type:Array,notify:!0},_previousFavoriteProducts:{type:Array},favoriteCategories:{type:Array,notify:!0},favoriteSharedCategories:{type:Array,notify:!0},manualOrdersHistory:{type:Array,notify:!0},query:{type:String,notify:!0},_currentProduct:{type:Object},_selectedProductsId:{type:Array},_action:{type:Object},_multipleEdit:{type:Object}},observers:["_setCurrentProductName(_currentProduct.content)","_doAction(_action.type, _action.id)"],ready:function(){this._previousFavoriteProducts=this.favoriteProducts,this.query="",this._selectedProductsId=[],this._multipleEdit={},this._resetCurrentProduct(),this.$.toggleDrawerMenu.addEventListener("tap",this._openDrawer.bind(this)),this.$.floatingToolbar.addEventListener("tap",this._openSelectCategoryDialog.bind(this)),this.$.openStoreDialogButton.addEventListener("tap",this._openStoreDialog.bind(this)),this.$.deleteProductButton.addEventListener("tap",this._deleteProduct.bind(this)),this.$.addProductFab.addEventListener("tap",this._openAddProductDialog.bind(this)),this.$.addProductButton.addEventListener("tap",this._addProduct.bind(this)),this.$.openEditMultipleProductButton.addEventListener("tap",this._openEditProductDialog.bind(this)),this.$.openEditProductButton.addEventListener("tap",this._openEditProductDialog.bind(this)),this.$.openConfirmationDeleteProductButton.addEventListener("tap",this._openConfirmationRemoveProductsDialog.bind(this)),this.$.saveProductButton.addEventListener("tap",this._saveProduct.bind(this)),this.$.copyProductLinkButton.addEventListener("tap",this._copyProductLink.bind(this)),this.$.makeMultipleEditButton.addEventListener("tap",this._makeMultipleEdit.bind(this))},_updateFavoriteSharedProducts:function(){for(var t=this.favoriteProducts,e=[],r=0;r<t.length;r++){var o=t[r];o.shared&&e.push(o)}this.set("favoriteSharedProducts",e)},_openDrawer:function(){document.getElementById("appshell")._openDrawer()},_openSelectCategoryDialog:function(){this.$.selectCategoryDialog.open()},_openStoreDialog:function(){this.$.storeDialog.open()},_openConfirmationRemoveProductsDialog:function(){this.$.confirmationRemoveProductsDialog.open()},_openViewProductDialog:function(t){var t=t||this._currentProduct.id,e=this._getProductIndexFromId(t);this.set("_currentProduct",this.favoriteProducts[e]),this.$.viewProductDialog.open(),this._selectedProductsId=[]},_openEditProductDialog:function(t){if(this._selectedProductsId.length>1)this.$.multipleEditIndexDialog.open();else{var t="";t="undefined"!=typeof this._selectedProductsId[0]?this._selectedProductsId[0]:this._currentProduct.id;var e=this._getProductIndexFromId(t);this.set("_currentProduct",this.favoriteProducts[e]),this.$.editProductDialog.open(),this._selectedProductsId=[]}},_openAddProductDialog:function(){this._resetCurrentProduct(),this.$.addProductDialog.open()},_oneSelected:function(t){return 1==t},_multipleSelected:function(t){return t>=1},_doAction:function(t,e){switch(t){case"edit":this._openEditProductDialog(e);break;case"view":this._openViewProductDialog(e)}this._action={}},_makeMultipleEdit:function(){for(var t=this._multipleEdit.stockChange||0,e=this._getProductIndexFromIds(),r=0;r<e.length;r++){var o=e[r],i=parseInt(this.favoriteProducts[o].stock);i+=parseInt(t),this.set("favoriteProducts."+o+".stock",i)}this._multipleEdit={},this._updateFavoriteSharedProducts()},_copyProductLink:function(){var t=" ",e=document.getElementById("appshell");e.showToast("Successfully copied to your clipboard"),e.copyToClipboard(t)},_deleteProduct:function(){this._previousFavoriteProducts=this.favoriteProducts;var t=this._getProductIndexFromIds();t.sort(function(t,e){return e-t});for(var e=0;e<t.length;e++){var r=t[e];this.splice("favoriteProducts",r,1)}this._selectedProductsId=[],this._updateFavoriteSharedProducts()},_undoDeleteProduct:function(){this.set("favoriteProducts",this._previousFavoriteProducts),this._updateFavoriteSharedProducts()},_saveProduct:function(){var t=this._currentProduct.id,e=this._getProductIndexFromId(t),r="favoriteProducts."+e,o=this._currentProduct;o.created=Date.now(),"object"!=typeof o.tags&&(o.tags=[""]),this.set(r,o),this.set(r+".name",o.name),this.set(r+".image",o.image),this._updateFavoriteSharedProducts()},_addProduct:function(){var t=this._currentProduct;t.id=this._generateId(),t.created=Date.now(),this.push("favoriteProducts",t),this._resetCurrentProduct(),this._updateFavoriteSharedProducts()},_setCurrentProductName:function(t){},_resetSelection:function(){this._selectedProductsId=[]},_resetCurrentProduct:function(){var t={name:"",shortDescription:"",longDescription:"",options:[],stock:0,contents:[],tags:[],priceValue:0,priceType:"STEEM"};this.set("_currentProduct",t)},_generateId:function(){var t=Date.now()*Math.random();return t},_arrayAsString:function(t){var e="";if("undefined"!=typeof t)for(var r=t.length||0,o=0;o<r;o++)e+=t[o],o<r-1&&(e+=", ");return e},_getProductIndexFromIds:function(t){for(var e=[],t=t||this._selectedProductsId,r=t.length,o=this.favoriteProducts,i=o.length,d=0;d<r;d++)for(var s=t[d],n=0;n<i;n++){var a=o[n];a.id==s&&e.push(n)}return e},_getSharedProductIndexFromIds:function(t){for(var e=[],t=t||this._selectedProductsId,r=t.length,o=this.favoriteSharedProducts,i=o.length,d=0;d<r;d++)for(var s=t[d],n=0;n<i;n++){var a=o[n];a.id==s&&e.push(n)}return e},_getProductIndexFromId:function(t){var e=[t],r=this._getProductIndexFromIds(e);return r[0]},_getSharedProductIndexFromId:function(t){var e=[t],r=this._getSharedProductIndexFromIds(e);return r[0]},computeFilter:function(t){return t?(t=t.toLowerCase(),function(e){var r=!1,o=e.name.toLowerCase(),i=t.split(" "),d=i.length,s=[];"undefined"!=typeof e.tags&&(s=e.tags);var n=s.length;if(1==d){o.includes(i[0].replace(/\-/gm," "))&&(r=!0);for(var a=0;a<n;a++){var u=s[a].toLowerCase();u==i[0]&&(r=!0)}}else{for(var c=!0,a=0;a<d-1;a++){for(var h=i[a],p=!1,l=0;l<n;l++){var u=s[l].toLowerCase();u==h&&(p=!0)}p||(c=!1)}for(var P=!1,_=i[d-1].replace(/\-/gm," "),a=0;a<n;a++){var u=s[a].toLowerCase();u==_&&(P=!0)}o.includes(_)&&(P=!0),P&&c&&(r=!0)}return r}):null}});</script></body></html>
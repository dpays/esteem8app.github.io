<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-out-animation.html">

<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-toggle-button/paper-toggle-button.html">

<link rel="import" href="../../bower_components/paper-tags/paper-tags.html">
<link rel="import" href="../../bower_components/paper-tags/paper-tags-input.html">

<link rel="import" href="../../bower_components/app-layout/app-drawer/app-drawer.html">

<link rel="import" href="../components/my-icons.html">
<link rel="import" href="../components/file-card.html">
<link rel="import" href="../components/html-echo.html">

<link rel="import" href="../dialogs/select-folder-dialog.html">
<link rel="import" href="../dialogs/manage-folders-dialog.html">

<link rel="import" href="../shared-styles.html">

</head><body><dom-module id="page-files">

    <template>

        <style include="shared-styles">

            /* GENERAL */
            :host {
                min-height: calc(100% - 16px);
                margin: 0;
                position: absolute;
                width: 100%;
                margin-top: -16px;
                padding-top: 16px;
                padding-bottom: 16px;
                display: block;
                background-color: var(--app-primary-background-color);
                overflow: hidden;
            }

            #appsDrawer {
                z-index: 6;
                --app-drawer-content-container: {
                    text-align: left;
                    color: var(--app-background-secondary-text-color);
                    background-color: var(--app-secondary-background-color);
                }

            }

            #adult {
                position: absolute;
                right: 16px;
            }

            #appsDrawer .title {
                padding-left: 16px;
            }

            #toolsList {
                overflow: auto !important;
                max-height: calc(100vh - 116px) !important;
            }

            #toolsList paper-item {
                cursor: pointer;
            }

            #fileOptionToolbar {
                background-color: var(--app-dark-primary-color);
                color: var(--app-primary-text-color);
                width: 100%;
                cursor: pointer;
            }

            .floatingToolbarTitle div {
                display: inline;
            }

            #mainToolbar {
                z-index: 5;
            }

            .mainToolbar .bottom div {
                display: inline;
            }

            .mainToolbar .bottom div[hidden] {
                display: none;
            }

            .dark-primary {
                text-align: right;
                width: 100%;
            }

            #files {
                margin-top: 128px;
            }

            .file-cards {
                @apply(--layout-horizontal);
                @apply(--layout-wrap);
            }

            file-card {
                background-color: rgba(128, 128, 128, 0);
                transition: background-color ease-out .1s;
            }

            file-card.iron-selected {
                background-color: rgba(128, 128, 128, 0.4);
                transition: background-color ease-in .1s;
            }

            #addFileFab {
                background-color: var(--app-secondary-color);
                color: var(--app-secondary-text-color);
                position: fixed;
                bottom: 16px;
                right: 16px;
                z-index: 4;
            }

            paper-dialog {
                background-color: var(--app-secondary-background-color);
                color: var(--app-background-primary-text-color)
            }

            paper-dialog .buttons paper-button {
                color: var(--app-secondary-color);
            }

            .toggle {
                height: 64px;
                line-height: 64px;
            }

            .toggle paper-toggle-button {
                float: right;
                margin-top: 18px;
            }

            paper-toggle-button {
                --paper-toggle-button-checked-bar-color: var(--app-secondary-color);
                --paper-toggle-button-checked-button-color:  var(--app-secondary-color);
                --paper-toggle-button-checked-ink-color:  var(--app-secondary-color);
            }

            paper-input, paper-tags-input, paper-textarea {
                --paper-input-container-focus-color: var(--app-secondary-color);
                --paper-input-container-input-color: var(--app-background-primary-text-color);
                --paper-input-container-color: var(--app-background-secondary-text-color);
            }

            paper-tags, paper-tags-input {
                --paper-tag-margin: 4px;
                --paper-tag-focus-color: var(--app-secondary-color);
                --paper-tag-text-color: var(--app-background-primary-text-color);
                --paper-tags-item: {
                    padding-left: 8px !important;
                    color: var(--app-secondary-color) !important;
                };
            }

            .closeViewButton {
                color: var(--app-background-primary-text-color);
                position: absolute;
                right: 0;
                top: 0;
                padding: 8px !important;
                margin: 16px;
            }

            #viewFileDialog h2 {
                display: inline;
            }

            #openEditFileButton {
                padding: 8px;
            }

            #noFileText {
                text-align: center;
                width: 100%;
                padding-top: 36px;
                color: var(--app-background-primary-text-color);
            }


        </style>

        <select-folder-dialog id="selectFolderDialog" selected-folder="{{query}}" favorite-folders="{{favoriteFolders}}" is-manage-folders-dialog-opened="{{_isManageFoldersDialogOpened}}">&gt;
        </select-folder-dialog>

        
        <manage-folders-dialog id="manageFoldersDialog" opened="{{_isManageFoldersDialogOpened}}" folders="{{favoriteFolders}}" favorite-shared-categories="{{favoriteSharedFolders}}">
        </manage-folders-dialog>

        <app-drawer id="appsDrawer" align="right">

            <h2 class="title">Tools</h2>

            <div id="externalApps">

                <paper-item>
                    <span>18+</span>
                    <paper-toggle-button id="adult" checked="{{adult}}"></paper-toggle-button>
                </paper-item>

                <div id="toolsList">
                    <template is="dom-repeat" items="[[_externalApps]]" filter="{{computeToolsFilter(adult)}}">
                        <paper-item on-tap="_openThisApp()">
                            [[item.name]]
                        </paper-item>
                    </template>
                </div>

            </div>
        </app-drawer>

        
        <paper-toolbar id="mainToolbar" class="mainToolbar medium-tall">

            <paper-icon-button icon="my-icons:menu" id="toggleDrawerMenu" on-tap="_openDrawer()">
            </paper-icon-button>
            <div id="floatingToolbar" on-tap="_openSelectFolderDialog()" class="floatingToolbar">
                <span class="floatingToolbarTitle">
                    <div>#[[query]]</div>
                </span>
            </div>

            <paper-icon-button id="appsDrawerButton" on-tap="_openAppsDrawer()" icon="my-icons:apps">
            </paper-icon-button>

            <div class="bottom right dark-primary">

                <div hidden="[[!_multipleSelected(_selectedFilesId.length)]]">
                    <paper-icon-button id="openConfirmationDeleteFileButton" on-tap="_openConfirmationRemoveFilesDialog()" icon="my-icons:delete">
                    </paper-icon-button>
                </div>

                <div hidden="[[!_multipleSelected(_selectedFilesId.length)]]">
                    <paper-icon-button id="openFileLinkButton" on-tap="_openFileLink()" icon="my-icons:link">
                    </paper-icon-button>
                </div>

                <div hidden="[[!_multipleSelected(_selectedFilesId.length)]]">
                    <paper-icon-button id="copyFileLinkButton" on-tap="_copyFileLink()" icon="my-icons:copy">
                    </paper-icon-button>
                </div>

            </div>
        </paper-toolbar>

        
        <paper-dialog id="confirmationRemoveFilesDialog" entry-animation="fade-in-animation" exit-animation="fade-out-animation" with-backdrop="">

            <h2>Confirmation</h2>
            <p>Remove
                <span class="secondary-color">[[_selectedFilesId.length]]</span>
                files from favorite ?
            </p>

            <div class="buttons">
                <paper-button dialog-dismiss="">
                    Cancel
                </paper-button>
                <paper-button dialog-confirm="" autofocus="" id="deleteFileButton" on-tap="_deleteFile()">
                    Yes
                </paper-button>
            </div>
        </paper-dialog>

        
        <paper-dialog id="addFileDialog" class="bigDialog withBottomAction" entry-animation="fade-in-animation" exit-animation="fade-out-animation" with-backdrop="">

            <h2>Add a file</h2>

            <paper-icon-button class="closeViewButton" icon="my-icons:close" dialog-dismiss="">
            </paper-icon-button>

            <div class="scrollable">

                <paper-input label="Name" value="{{_currentFile.name}}">
                </paper-input>

                <paper-textarea label="Url or Text" value="{{_currentFile.content}}">
                </paper-textarea>

                <paper-tags-input label="Tags" items="{{_currentFile.manualTags}}">
                </paper-tags-input>

                <div class="toggle">
                    <span>Share file</span>
                    <paper-toggle-button checked="{{_currentFile.shared}}"></paper-toggle-button>
                </div>

                <div class="defaultTags">
                    <paper-tags items="{{_currentFile.defaultTags}}"></paper-tags>
                </div>

            </div>

            <div class="buttons">
                <paper-button dialog-dismiss="">
                    Cancel
                </paper-button>
                <paper-button dialog-confirm="" autofocus="" id="addFileButton" on-tap="_addFile()">
                    Add
                </paper-button>
            </div>
        </paper-dialog>

        
        <paper-dialog id="editFileDialog" class="bigDialog withBottomAction">

            <h2>Edit a file</h2>

            <paper-icon-button class="closeViewButton" icon="my-icons:close" dialog-dismiss="">
            </paper-icon-button>

            <div class="scrollable">

                <paper-input label="Name" value="{{_currentFile.name}}">
                </paper-input>

                <paper-textarea label="Url or Text" value="{{_currentFile.content}}">
                </paper-textarea>

                <paper-tags-input label="Tags" items="{{_currentFile.manualTags}}">
                </paper-tags-input>

                <div class="toggle">
                    <span>Share file</span>
                    <paper-toggle-button checked="{{_currentFile.shared}}"></paper-toggle-button>
                </div>

                <div class="defaultTags">
                    <paper-tags items="{{_currentFile.defaultTags}}"></paper-tags>
                </div>

            </div>

            <div class="buttons">
                <paper-button dialog-dismiss="">
                    Cancel
                </paper-button>
                <paper-button dialog-confirm="" autofocus="" id="saveFileButton" on-tap="_saveFile()">
                    Save
                </paper-button>
            </div>
        </paper-dialog>

        
        <paper-dialog id="viewFileDialog" class="bigDialog" entry-animation="fade-in-animation" exit-animation="fade-out-animation" with-backdrop="">

            <h2>[[_currentFile.name]]</h2>

            <paper-icon-button icon="my-icons:edit" id="openEditFileButton" on-tap="_openEditFileDialog()">
            </paper-icon-button>

            <paper-icon-button class="closeViewButton" icon="my-icons:close" dialog-dismiss="">
            </paper-icon-button>

            <div class="scrollable">
                <html-echo html=" [[_currentFile.content]] "></html-echo>
            </div>

        </paper-dialog>

        <div id="files">

            <template is="dom-if" if="[[!favoriteFiles.length]]">
                <h2 id="noFileText">You don't have any files</h2>
            </template>

            <template is="dom-if" if="[[favoriteFiles.length]]">
                <div class="file-cards">
                        <template is="dom-repeat" items="[[favoriteFiles]]" filter="{{computeFilter(query)}}">
                            <file-card file="[[item]]" file-id="[[item.id]]" action="{{_action}}" selected-files="{{_selectedFilesId}}">
                            </file-card>
                        </template>
                </div>
            </template>

        </div>

        <paper-fab id="addFileFab" on-tap="_openAddFileDialog()" icon="my-icons:add">
        </paper-fab>

    </template>
</dom-module>

<script>Polymer({is:"page-files",properties:{settings:{type:Object},favoriteFiles:{type:Array,notify:!0},favoriteSharedFiles:{type:Array,notify:!0},_previousFavoriteFiles:{type:Array},favoriteFolders:{type:Array,notify:!0},query:{type:String,notify:!0},_currentFile:{type:Object},_selectedFilesId:{type:Array},_action:{type:Object},_externalApps:{type:Array},_isManageFoldersDialogOpened:{type:Boolean}},observers:["_setCurrentFileName(_currentFile.content)","_setCurrentFileDefaultTags(_currentFile.content)","_doAction(_action.type, _action.id)"],listeners:{"externalApps.tap":"_openThisApp"},ready:function(){this.pastFiles=this.favoriteFiles,this.query="",this._selectedFilesId=[],this._resetCurrentFile(),this._externalApps=[{name:"Google docs",icon:"text-file",url:"https://docs.google.com/document/",adult:!1},{name:"Google sheets",icon:"",url:"https://docs.google.com/spreadsheets/",adult:!1},{name:"Google slides",icon:"",url:"https://docs.google.com/presentation/",adult:!1},{name:"Google forms",icon:"",url:"https://docs.google.com/forms/",adult:!1},{name:"Google drawings",icon:"",url:"https://docs.google.com/drawings/",adult:!1},{name:"Youtube",icon:"",url:"https://www.youtube.com/",adult:!1},{name:"Twitch",icon:"",url:"https://www.twitch.tv/",adult:!1},{name:"Soundcloud",icon:"",url:"https://soundcloud.com/",adult:!1},{name:"GitHub",icon:"",url:"https://github.com/",adult:!1},{name:"Discord",icon:"",url:"https://discordapp.com/",adult:!1},{name:"Pornhub",icon:"",url:"http://www.pornhub.com/",adult:!0},{name:"Tube8",icon:"",url:"http://www.tube8.com/",adult:!0}],this.$.toggleDrawerMenu.addEventListener("tap",this._openDrawer.bind(this)),this.$.appsDrawerButton.addEventListener("tap",this._openAppsDrawer.bind(this)),this.$.floatingToolbar.addEventListener("tap",this._openSelectFolderDialog.bind(this)),this.$.deleteFileButton.addEventListener("tap",this._deleteFile.bind(this)),this.$.openFileLinkButton.addEventListener("tap",this._openFileLink.bind(this)),this.$.addFileFab.addEventListener("tap",this._openAddFileDialog.bind(this)),this.$.addFileButton.addEventListener("tap",this._addFile.bind(this)),this.$.openEditFileButton.addEventListener("tap",this._openEditFileDialog.bind(this)),this.$.openConfirmationDeleteFileButton.addEventListener("tap",this._openConfirmationRemoveFilesDialog.bind(this)),this.$.saveFileButton.addEventListener("tap",this._saveFile.bind(this)),this.$.copyFileLinkButton.addEventListener("tap",this._copyFileLink.bind(this))},_openDrawer:function(){document.getElementById("appshell")._openDrawer()},_openAppsDrawer:function(){this.$.appsDrawer.open()},_openSelectFolderDialog:function(){this.$.selectFolderDialog.open()},_openConfirmationRemoveFilesDialog:function(){this.$.confirmationRemoveFilesDialog.open()},_openViewFileDialog:function(e){var e=e||this._currentFile.id,t=this._getFileIndexFromId(e);this.set("_currentFile",this.favoriteFiles[t]),this.$.viewFileDialog.open(),this._selectedFilesId=[]},_openEditFileDialog:function(e){this.$.editFileDialog.open(),this._selectedFilesId=[]},_openAddFileDialog:function(){this._resetCurrentFile(),this.$.addFileDialog.open()},_openThisApp:function(e){var t=e.model.item.url;t.includes("https")?window.open(t):(window.history.pushState({},null,t),window.dispatchEvent(new CustomEvent("location-changed")))},_oneSelected:function(e){return 1==e},_multipleSelected:function(e){return e>=1},_doAction:function(e,t){switch(e){case"edit":this._openEditFileDialog(t);break;case"view":this._openViewFileDialog(t)}this._action={}},_copyFileLink:function(){for(var e=" ",t=this._getFileIndexFromIds(),i=this.favoriteFiles,s=0;s<t.length;s++){var o=t[s],n=i[o],r=n.content;e+=r+" "}var l=document.getElementById("appshell");l.showToast("Successfully copied to your clipboard"),l.copyToClipboard(e)},_deleteFile:function(){this._previousFavoriteFiles=this.favoriteFiles;var e=this._getFileIndexFromIds();e.sort(function(e,t){return t-e});for(var t=0;t<e.length;t++){var i=e[t];this.splice("favoriteFiles",i,1)}this._selectedFilesId=[]},_undoDeleteFile:function(){this.set("favoriteFiles",this._previousFavoriteFiles)},_saveFile:function(){var e=this._currentFile.id,t=this._getFileIndexFromId(e),i="favoriteFiles."+t,s=this._currentFile,o=this._computeImageFromFile(s);if(s.image=o,s.created=Date.now(),"object"!=typeof s.manualTags&&(s.manualTags=[""]),this.set(i,s),this.set(i+".name",s.name),this.set(i+".image",s.image),"undefined"!=typeof s.shared)if(s.shared){var n=this._getSharedFileIndexFromId(s.id);if(n>=0){var r="favoriteSharedFiles"+n;this.set(r,s)}else this.push("favoriteSharedFiles",s)}else{var n=this._getSharedFileIndexFromId(s.id);n>=0&&this.splice("favoriteSharedFiles",n,1)}},_openFileLink:function(){for(var e=this._getFileIndexFromIds(),t=this.favoriteFiles,i=0;i<e.length;i++){var s=e[i],o=t[s],n=this._isFileALink(o);n?window.open(fileContent):this._openViewFileDialog(o.id)}},_addFile:function(){var e=this._currentFile,t=this._computeImageFromFile(e);e.image=t,e.id=this._generateId(),e.created=Date.now(),"object"!=typeof e.manualTags&&(e.manualTags=[""]),this.push("favoriteFiles",e),this._resetCurrentFile()},_computeTagsFromFile:function(e){function t(e){var t;return t=e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0],t=t.split(":")[0]}if("undefined"==typeof e)return[];var i=[];if(this._isFileALink(e)){var s=e.content,o=t(s);i.push(o),s.includes(".png")||s.includes(".jpg")||s.includes(".jpeg")||s.includes(".gif")?(i.push("media"),i.push("image"),i.push("photo")):s.includes("docs.google.com/document")?(i.push("file"),i.push("doc"),i.push("google"),i.push("document")):s.includes("docs.google.com/drawings")?(i.push("file"),i.push("doc"),i.push("document"),i.push("google"),i.push("drawing")):s.includes("docs.google.com/forms")?(i.push("file"),i.push("google"),i.push("form")):s.includes("docs.google.com/spreadsheets")?(i.push("file"),i.push("doc"),i.push("document"),i.push("google"),i.push("spreadsheet"),i.push("sheet")):s.includes("docs.google.com/presentation")?(i.push("file"),i.push("doc"),i.push("document"),i.push("files"),i.push("google"),i.push("presentation")):s.includes("github.com")?(i.push("file"),i.push("files"),i.push("doc"),i.push("document"),i.push("github"),i.push("it")):s.includes("soundcloud.com")?(i.push("media"),i.push("sound"),i.push("soundcloud")):s.includes("youtube.com")?(i.push("media"),i.push("video"),i.push("youtube"),i.push("google")):s.includes("twitch.tv")?(i.push("media"),i.push("video"),i.push("gaming"),i.push("streaming")):s.includes("pornhub.com")&&(i.push("media"),i.push("video"))}else i.push(e.name),i.push("file"),i.push("doc"),i.push("document"),i.push("md"),i.push("markdown");return i},_computeImageFromFile:function(e){if(e.url=e.content,e.url.includes(".png")||e.url.includes(".jpg")||e.url.includes(".jpeg")||e.url.includes(".gif"))return e.url;if(e.url.includes("docs.google.com/document"))return"https://github.com/esteem8app/esteem8app.github.io/blob/master/src/images/google/docs.png?raw=true";if(e.url.includes("docs.google.com/drawings"))return"https://github.com/esteem8app/esteem8app.github.io/blob/master/src/images/google/drawing.png?raw=true";if(e.url.includes("docs.google.com/forms"))return"https://github.com/esteem8app/esteem8app.github.io/blob/master/src/images/google/forms.png?raw=true";if(e.url.includes("docs.google.com/spreadsheets"))return"https://github.com/esteem8app/esteem8app.github.io/blob/master/src/images/google/sheets.png?raw=true";if(e.url.includes("docs.google.com/presentation"))return"https://github.com/esteem8app/esteem8app.github.io/blob/master/src/images/google/slides.png?raw=true";if(e.url.includes("github.com"))return"https://github.com/esteem8app/esteem8app.github.io/blob/master/src/images/github/octocat.png?raw=true";if(e.url.includes("soundcloud.com"))return"https://github.com/esteem8app/esteem8app.github.io/blob/master/src/images/other/soundcloud.png?raw=true";if(e.url.includes("youtube.com")){var t=e.url.replace("https://www.youtube.com/watch?v=","").replace("https://youtu.be/","");return"https://img.youtube.com/vi/"+t+"/0.jpg"}return e.url.includes("twitch.tv")?"https://github.com/esteem8app/esteem8app.github.io/blob/master/src/images/other/twitch.png?raw=true":e.url.includes("pornhub.com")?"https://github.com/esteem8app/esteem8app.github.io/blob/master/src/images/other/pornhub-logo.jpg?raw=true":"https://github.com/esteem8app/esteem8app.github.io/blob/master/src/images/other/txt.png?raw=true"},_setCurrentFileName:function(e){},_setCurrentFileDefaultTags:function(e){var t=this._computeTagsFromFile(this._currentFile);this.set("_currentFile.defaultTags",t)},_resetSelection:function(){this._selectedFilesId=[]},_resetCurrentFile:function(){var e={name:"",content:"",manualTags:[]};this.set("_currentFile",e)},_generateId:function(){var e=Date.now()*Math.random();return e},_arrayAsString:function(e){var t="";if("undefined"!=typeof e)for(var i=e.length||0,s=0;s<i;s++)t+=e[s],s<i-1&&(t+=", ");return t},_isFileALink:function(e){var t=e.content.replace(/ /gm,"");return t.match(/(https?:\/\/)?[a-zA-Z0-9]*\.[a-zA-Z0-9\.]*\/[a-zA-Z0-9-\.\/\%\&\=\?\+]*/)},_getFileIndexFromIds:function(e){for(var t=[],e=e||this._selectedFilesId,i=e.length,s=this.favoriteFiles,o=s.length,n=0;n<i;n++)for(var r=e[n],l=0;l<o;l++){var a=s[l];a.id==r&&t.push(l)}return t},_getSharedFileIndexFromIds:function(e){for(var t=[],e=e||this._selectedFilesId,i=e.length,s=this.favoriteSharedFiles,o=s.length,n=0;n<i;n++)for(var r=e[n],l=0;l<o;l++){var a=s[l];a.id==r&&t.push(l)}return t},_getFileIndexFromId:function(e){var t=[e],i=this._getFileIndexFromIds(t);return i[0]},_getSharedFileIndexFromId:function(e){var t=[e],i=this._getSharedFileIndexFromIds(t);return i[0]},computeToolsFilter:function(e){return function(t){return!!e||(0==t.adult||void 0)}},computeFilter:function(e){return e?(e=e.toLowerCase(),function(t){var i=!1,s=t.name.toLowerCase(),o=e.split(" "),n=o.length,r=[],l=[];"undefined"!=typeof t.manualTags&&(r=t.manualTags),"undefined"!=typeof t.defaultTags&&(l=t.defaultTags||[]);var a=r.concat(l),u=a.length;if(1==n){s.includes(o[0].replace(/\-/gm," "))&&(i=!0);for(var d=0;d<u;d++){var p=a[d].toLowerCase();p==o[0]&&(i=!0)}}else{for(var h=!0,d=0;d<n-1;d++){for(var c=o[d],g=!1,m=0;m<u;m++){var p=a[m].toLowerCase();p==c&&(g=!0)}g||(h=!1)}for(var f=!1,F=o[n-1].replace(/\-/gm," "),d=0;d<u;d++){var p=a[d].toLowerCase();p==F&&(f=!0)}s.includes(F)&&(f=!0),f&&h&&(i=!0)}return i}):null}});</script></body></html>
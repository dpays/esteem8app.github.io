<html><head><link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../components/file-card.html">
<link rel="import" href="../dialogs/view-file-dialog.html">

<link rel="import" href="../shared-styles.html">

</head><body><dom-module id="profile-files">

    <template>

        <style include="shared-styles">

            /* GENERAL */
            :host{

            }

        </style>

        <view-file-dialog id="viewFileDialog" file="[[_file]]">
        </view-file-dialog>

        <div id="folder-list">

            <paper-button id="resetFileQueryButton" on-tap="_resetFileQuery()" hidden="[[!folders.length]]">
                all
            </paper-button>

            <template is="dom-repeat" items="[[folders]]">
                <paper-button on-tap="_setFileQuery()">
                    [[item.name]]
                </paper-button>
            </template>

        </div>

        <div id="file-list">

            <template is="dom-repeat" items="[[files]]" filter="{{_getFilesFilter(_fileQuery)}}">
                <file-card file="[[item]]" action="{{_actionFile}}" allow-select="false">
                </file-card>
            </template>

        </div>

    </template>
</dom-module>

<script>Polymer({is:"profile-files",properties:{files:{type:Array},folders:{type:Array},_file:{type:Object},_fileQuery:{type:String}},listeners:{"folder-list.tap":"_setFileQuery"},observers:["_doAction(_actionFile.type, _actionFile.id)"],ready:function(){this.$.resetFileQueryButton.addEventListener("tap",this._resetFileQuery.bind(this))},_doAction:function(e,i){switch(e){case"view":this._openViewFile(i)}},_openViewFile:function(e){for(var i=0;i<this.files.length;i++)this.files[i].id==e&&(this.set("_file",this.files[i]),this.$.viewFileDialog.open())},_setFileQuery:function(e){this._fileQuery=e.model.item.name},_resetFileQuery:function(){this._fileQuery=""},_getFilesFilter:function(e){return e?(e=e.toLowerCase(),function(i){var t=[],r=!1,s=e.split(" ");"undefined"!=typeof i.tags&&(t=i.tags);for(var l=0;l<s.length;l++){for(var n=s[l].toLowerCase(),o=!1,f=0;f<t.length;f++){var a=t[f].toLowerCase();a==n&&(o=!0)}r=o}return r}):null}});</script></body></html>
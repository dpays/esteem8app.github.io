var selectionchange=function(e){function t(t){var n=t.onselectionchange;if(n!==e)try{return t.onselectionchange=0,null===t.onselectionchange}catch(e){}finally{t.onselectionchange=n}return!1}function n(){return"undefined"!=typeof WeakMap?new WeakMap:(console.error("selectionchange: WeakMap not supported"),null)}function o(e){var t=e.getSelection();return t.rangeCount?t.getRangeAt(0):null}function u(e,t,n){e.addEventListener(t,n,!0)}function i(e,t,n){e.removeEventListener(t,n,!0)}function s(e){b[e.target.tagName]||d(this,!0)}function a(e){var t=e.keyCode;(65===t&&e[p]&&!e.shiftKey&&!e.altKey||t>=35&&t<=40||e.ctrlKey&&v&&g.indexOf(t)>=0)&&(b[e.target.tagName]||setTimeout(d.bind(null,this),0))}function c(e){0===e.button&&(u(this,"mousemove",r),setTimeout(d.bind(null,this),0))}function r(e){1&e.buttons?d(this):i(this,"mousemove",r)}function l(e){0===e.button?setTimeout(d.bind(null,this),0):i(this,"mousemove",r)}function f(){setTimeout(d.bind(null,this.document),0)}function d(e,t){var n=o(e);!t&&m(n,h.get(e))||(h.set(e,n),setTimeout(e.dispatchEvent.bind(e,new Event("selectionchange")),0))}function m(e,t){return e===t||e&&t&&y.every(function(n){return e[n]===t[n]})}var h,v=/^Mac/.test(navigator.platform),g=[65,66,69,70,78,80],p=v?"metaKey":"ctrlKey",y=["startContainer","startOffset","endContainer","endOffset"],b={INPUT:1,TEXTAREA:1};return{start:function(e){var i=e||document;(h||!t(i)&&(h=n()))&&(h.has(i)||(h.set(i,o(i)),u(i,"input",s),u(i,"keydown",a),u(i,"mousedown",c),u(i,"mousemove",r),u(i,"mouseup",l),u(i.defaultView,"focus",f)))},stop:function(e){var t=e||document;h&&h.has(t)&&(h.delete(t),i(t,"input",s),i(t,"keydown",a),i(t,"mousedown",c),i(t,"mousemove",r),i(t,"mouseup",l),i(t.defaultView,"focus",f))}}}();"undefined"!=typeof module&&(module.exports=selectionchange);
<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="../../bower_components/neon-animation/animations/fade-out-animation.html">

<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<!--link rel="import" href="../../bower_components/iron-scroll-target-behavior/iron-scroll-target-behavior.html"-->
<link rel="import" href="../../bower_components/iron-scroll-threshold/iron-scroll-threshold.html">

<link rel="import" href="../../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-menu/paper-submenu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-styles/shadow.html">

<link rel="import" href="../components/post-card-light.html">
<link rel="import" href="../components/post-card.html">
<link rel="import" href="../components/reply-card.html">
<link rel="import" href="../components/event-card.html">
<link rel="import" href="../components/user-card.html">
<link rel="import" href="../components/file-card.html">
<link rel="import" href="../components/product-card.html">
<link rel="import" href="../components/html-echo.html">
<link rel="import" href="../components/post-wrapper.html">
<link rel="import" href="../components/profile-informations.html">
<link rel="import" href="../components/profile-about.html">

<link rel="import" href="../dialogs/wallet-dialog.html">
<link rel="import" href="../dialogs/product-content.html">

<link rel="import" href="../api/steemjs/steem-get-state.html">
<link rel="import" href="../api/steemjs/steem-get-post.html">
<link rel="import" href="../api/steemjs/steem-get-account.html">
<link rel="import" href="../api/steemjs/steem-get-follow-count.html">
<link rel="import" href="../api/steemjs/steem-get-followers.html">
<link rel="import" href="../api/steemjs/steem-get-following.html">
<link rel="import" href="../api/steemjs/steem-get-replies.html">
<link rel="import" href="../api/steemjs/steem-get-history.html">

<link rel="import" href="../components/my-icons.html">
<link rel="import" href="../shared-styles.html">

<dom-module id="page-profile">

    <template>

        <style include="shared-styles">

            /* Inspiration from https://www.uplabs.com/collections/profile-fd2d2339-bc35-44ae-822a-983aa31fa15a */

            /* GENERAL */
            :host {
                min-height: calc(100% - 16px);
                margin: 0;
                position: absolute;
                width: 100%;
                padding-bottom: 16px;
                display: block;
                background-color: var(--app-primary-background-color);
            }

            /* DIALOG */
            .closeViewButton {
                color: var(--app-background-primary-text-color);
                position: absolute;
                right: 0;
                top: 0;
                padding: 8px !important;
                margin: 16px;
            }

            /* TOOLBAR */
            #toggleFavoriteUserButton {
                float: right;
            }

            .reputation {
                font-size: 12px;
                padding: 4px;
                border-radius: 33px;
                background-color: var(--app-primary-text-color);
                color: var(--app-primary-color);
            }

            #progress-bar {
                width: 100%;
                position: fixed;
                z-index: 3;
                left: 0;
                top: 0;
                --paper-progress-active-color: var(--app-secondary-color);
                --paper-progress-container-color: var(--app-primary-color);
            }

            /* HEADER */
            #profileheader {
                background-color: var(--app-primary-color);
                background-size: cover;
                background-position: center;
                background-attachment: fixed;
                color: var(--app-primary-text-color);
                width: 100%;
                padding-top: 16px;
                margin-top: 44px;
            }

            @media (max-width: 600px) {
                #profileheader {
                    margin-top: 36px;
                }
            }

            .profileRepresentation {
                width: 124px;
                height: 124px;
                border-radius: 124px;
            }

            #topheader {
                margin: 16px auto;
                max-width: 600px;
                max-height: 600px;
            }

            .headerLeftPart {
                display: inline-block;
                height: 124px;
                margin: 16px;
            }

            @media screen and (max-width: 400px) {
                .headerRightPart {
                    margin-left: 0 !important;
                }
            }

            .headerRightPart {
                display: inline-block;
                position: absolute;
                height: 124px;
                margin: 8px;
                font-size: 16px;
            }

            .followed, .followers {
                margin-left: 32px;
                padding: 4px;
                display: inline-block;
                transition: all .2s;
            }

            .followed:active, .followers:active {
                background-color: rgba(255, 255, 255, .2);
                transition: all .2s;
            }

            .number {
                font-size: 32px;
                font-weight: bold;
                display: block;
            }

            /* TABS */
            #profileTabs {
                @apply(--shadow-elevation-2dp);
                background-color: var(--app-dark-primary-color);
                --paper-tabs-selection-bar-color: var(--app-secondary-color);
            }

            #profileTabs paper-tab {
                --paper-tab-ink: var(--app-secondary-color);
            }

            /* AFTER TABS CONTENT */
            div[name="posts"], div[name="replies"], div[name="history"], div[name="files"], div[name="articles"], div[name="followers"], div[name="following"] {
                max-width: 800px;
                margin: 12px auto;
            }

            .nothingText {
                display: table;
                margin-left: auto;
                margin-right: auto;
                margin-top: 100px;
                color: var(--app-background-primary-text-color);
            }

            /* ABOUT */

            div[name="about"] {
                padding-top: 12px;
            }

            div[name="about"] {
                color: var(--app-background-secondary-text-color);
                max-width: 800px;
                margin: auto;
            }

            @media screen and (max-width: 800px) {
                div[name="about"] {
                   min-width: 100%;
                }

                paper-card {
                    min-width: 0px !important;
                    width: 100%;
                }
            }

            div[name="about"] h2 {
                margin-bottom: 0px;
                margin-left: 8px;
            }

            #aboutViewName {
                display: inline-block;
                vertical-align: sub;
                margin-top: 0;
                color: var(--app-background-primary-text-color);
            }

            #votingPower {
                display: inline-flex;
                vertical-align: middle;
                width: 100%;
            }

            #votingPowerBar {
                width: 100%;
                --paper-slider-disabled-knob-color: var(--app-primary-color);
                --paper-slider-disabled-secondary-color: var(--app-background-secondary-text-color);
                --paper-slider-disabled-active-color: var(--app-background-primary-text-color);
            }

            .link a {
                color: var(--app-secondary-color) !important;
            }

            .link iron-icon {
                color: var(--app-background-primary-text-color);
            }

            paper-card {
                background-color: var(--app-secondary-background-color);
                --paper-card-header-text: {
                    font-size: 18px;
                    padding-bottom: 0;
                    text-transform: uppercase;
                    font-family: 'Roboto', 'Open Sans', sans-serif;
                    color: var(--app-background-primary-text-color);
                };
                margin-top: 12px;
                margin-bottom: 12px;
                min-width: 800px;
            }



            #lastestPostList {
                max-width: 568px;
                overflow: auto;
                display: inline-flex;
            }

            paper-menu-button {
                color: var(--app-background-primary-text-color);
                margin-left: 8px;
            }

            paper-menu, paper-item {
                background-color: var(--app-secondary-background-color);
                color: var(--app-background-secondary-text-color);
            }

            .pinnedPostVotes {
                color: var(--app-background-primary-text-color);
            }

            #viewArticleDialog {
                padding: 16px;
            }

            #openWalletButton {
                position: fixed;
                bottom: 16px;
                right: 16px;
                background-color: var(--app-secondary-color);
                color: var(--app-secondary-text-color);
            }

        </style>

        <!-- API -->

        <steem-get-account account-name="[[_accountName]]"
                           account="{{_account}}"
                           posts="{{_posts}}"
                           is-loading="{{_showProgress}}">
        </steem-get-account>

        <steem-get-follow-count account-name="[[_accountName]]"
                                follow-count="{{_followCount}}">
        </steem-get-follow-count>

        <steem-get-followers account-name="[[_accountName]]"
                             followers="{{_followers}}">
        </steem-get-followers>

        <steem-get-following account-name="[[_accountName]]"
                             following="{{_following}}">
        </steem-get-following>

        <!-- WALLET -->
        <wallet-dialog id="wallet"
                       user-name="[[userName]]"
                       settings="[[settings]]">
        </wallet-dialog>

        <!-- View a file -->
        <paper-dialog id="viewFileDialog"
                      class="bigDialog"
                      entry-animation="fade-in-animation"
                      exit-animation="fade-out-animation"
                      with-backdrop>

            <h2>[[_currentFile.name]]</h2>

            <paper-icon-button class="closeViewButton"
                               icon="my-icons:close"
                               dialog-dismiss>
            </paper-icon-button>

            <div class="scrollable">
                <html-echo html=" [[_currentFile.content]] "></html-echo>
            </div>

        </paper-dialog>

        <!-- View an article -->
        <paper-dialog id="viewArticleDialog"
                      class="bigDialog"
                      entry-animation="fade-in-animation"
                      exit-animation="fade-out-animation"
                      with-backdrop>

            <h2>[[_currentArticle.name]]</h2>

            <article-content article="[[_currentArticle]]"></article-content>

        </paper-dialog>

        <!-- TOOLBAR -->
        <paper-toolbar class="mainToolbar">

            <paper-icon-button id="toggleDrawerMenu"
                               on-tap="_openDrawer()"
                               icon="my-icons:menu">
            </paper-icon-button>

            <div class="floatingToolbar">
                <span class="floatingToolbarTitle">
                    <span>
                        [[userName]]
                        <span class="reputation">[[_account.reputation]]</span>
                    </span>
                    <span></span>
                    <paper-icon-button id="toggleFavoriteUserButton"
                                       icon="my-icons:[[_computeFavoriteUserIcon(_isUserInFavorite)]]"
                                       on-tap="_toggleFavoriteUser()">
                    </paper-icon-button>
                </span>
            </div>

            <a href="/hot/">
                <paper-icon-button icon="my-icons:explore"></paper-icon-button>
            </a>

            <paper-progress id="progress-bar"
                            indeterminate
                            hidden="[[!_showProgress]]">
            </paper-progress>
        </paper-toolbar>

        <!-- HEADER -->
        <div id="profileheader">

            <div id="topheader">

                <div class="headerLeftPart">
                    <template is="dom-if" if="[[_account.profileImage]]">
                        <iron-image class="profileRepresentation"
                                    sizing="cover"
                                    src="https://steemitimages.com/124x124/[[_account.profileImage]]">
                        </iron-image>
                    </template>
                    <template is="dom-if" if="[[!_account.profileImage]]">
                        <iron-icon class="profileRepresentation"
                                   icon="my-icons:person-circle">
                        </iron-icon>
                    </template>
                </div>

                <div class="headerRightPart">
                    <div id="followersButton"
                         class="followers"
                         on-tap="_setCurrentViewFollowers()">

                        <span class="number">
                            <template is="dom-if" if="[[_followCount.followerCount]]">[[_followCount.followerCount]]</template>
                            <template is="dom-if" if="[[!_followCount.followerCount]]">0</template>
                        </span>

                        <span class="texte">
                            Followers
                        </span>

                    </div>
                    <div id="followingButton"
                         class="followed"
                         on-tap="_setCurrentViewFollowers()">
                    <span class="number">
                        <template is="dom-if" if="[[_followCount.followingCount]]">
                            [[_followCount.followingCount]]
                        </template>
                        <template is="dom-if" if="[[!_followCount.followingCount]]">
                            0
                        </template>
                    </span>
                        <span class="texte">
                        Following
                    </span>
                    </div>
                </div>

            </div>

            <!-- TABS -->
            <paper-tabs id="profileTabs"
                        selected="{{_currentProfileView}}"
                        attr-for-selected="name"
                        fit-container
                        scrollable
                        no-slide>

                <paper-tab name="about"
                           id="tabAbout">
                    <iron-icon icon="my-icons:account-about"></iron-icon>
                </paper-tab>

                <paper-tab name="posts"
                           id="tabPosts">
                    <iron-icon icon="my-icons:text-file"></iron-icon>
                </paper-tab>

                <!--paper-tab name="comments">Comments</paper-tab-->

                <paper-tab name="replies"
                           id="tabReplies">
                    <iron-icon icon="my-icons:message-reply-text"></iron-icon>
                </paper-tab>
                <paper-tab name="history"
                           id="tabHistory">
                    <iron-icon icon="my-icons:history"></iron-icon>
                </paper-tab>

                <paper-tab name="files"
                           id="tabFiles"
                           hidden="[[_isTabFileHidden(_account.sharedFiles.length)]]">
                    <iron-icon icon="my-icons:text-file"></iron-icon>
                </paper-tab>

                <paper-tab name="articles"
                           id="tabArticles"
                           hidden="[[_isTabArticleHidden(_account.sharedArticles.length)]]">
                    <iron-icon icon="my-icons:shopping"></iron-icon>
                </paper-tab>

                <paper-tab name="followers"
                           id="tabFollowers">
                    <iron-icon icon="my-icons:follower"></iron-icon>
                </paper-tab>
                <paper-tab name="following"
                           id="tabFollowing">
                    <iron-icon icon="my-icons:following"></iron-icon>
                </paper-tab>
            </paper-tabs>

        </div>

        <!-- PAGE CONTENT -->
        <iron-pages selected="[[_currentProfileView]]"
                    attr-for-selected="name">

            <!-- ABOUT -->
            <div name="about">

                <!-- MENU BUTTON -->
                <paper-menu-button>
                    <paper-icon-button icon="menu" class="dropdown-trigger"></paper-icon-button>
                    <paper-menu id="aboutMenu" class="dropdown-content">
                        <paper-item view="home">Home</paper-item>
                        <template is="dom-if" if="[[_account.pinnedPosts]]">
                            <template is="dom-repeat" items="[[_account.pinnedPosts]]">
                                <paper-item view="[[item.name]]">[[_capitalizeFirstLetter(item.name)]]</paper-item>
                            </template>
                        </template>
                    </paper-menu>
                </paper-menu-button>


                <h2 id="aboutViewName">[[_capitalizeFirstLetter(_currentAboutView)]]</h2>

                <iron-pages selected="[[_currentAboutView]]"
                            attr-for-selected="name">

                    <div name="home">

                        <!-- INFORMATIONS -->
                        <profile-informations account="[[_account]]"
                                              class="homeCard">
                        </profile-informations>

                        <!-- ABOUT -->
                        <profile-about account="[[_account]]"
                                       class="homeCard">
                        </profile-about>

                        <!-- POSTS (light card) -->
                        <paper-card heading="POSTS" class="homeCard">
                            <post-path-list posts="[[_posts]]"
                                            query-path="false"
                                            post-type="card-light">
                            </post-path-list>
                        </paper-card>

                        <!-- PINED POSTS (presentation) -->
                        <template is="dom-if" if="[[_account.pinnedPost]]">
                            <paper-card>
                                <post-wrapper post-type="content-minimal"
                                              post-path="[[_account.pinnedPost]]">
                                </post-wrapper>
                            </paper-card>
                        </template>
                    </div>

                    <template is="dom-if" if="[[_account.pinnedPosts]]">
                        <template is="dom-repeat" items="[[_account.pinnedPosts]]" as="section">
                            <div name="[[section.name]]">
                                <template is="dom-repeat" items="[[section.posts]]" as="postPath">
                                    [[postPath]]
                                    <paper-card>
                                        <post-wrapper post-type="content-minimal"
                                                      post-path="[[postPath]]">
                                        </post-wrapper>
                                    </paper-card>
                                </template>
                            </div>
                        </template>
                    </template>

                </iron-pages>
            </div>

            <!-- POSTS -->
            <div name="posts">

                <div id="posts-list">

                    <template is="dom-if" if="[[!_posts.length]]">
                        <h1 class="nothingText">[[userName]] has not posted anything</h1>
                    </template>

                    <template is="dom-if" if="[[_posts.length]]">
                        <template is="dom-repeat" items="[[_posts]]">
                            <post-card post="[[item]]"
                                       settings="[[settings]]">
                            </post-card>
                        </template>
                    </template>

                </div>
            </div>

            <!-- REPLIES -->
            <div name="replies">
                <steem-get-replies user-name="[[_accountName]]"
                                   replies="{{_replies}}">
                </steem-get-replies>
                <div id="replies-list">

                    <template is="dom-if" if="[[!_replies.length]]">
                        <h1 class="nothingText">[[userName]] has no replies</h1>
                    </template>

                    <template is="dom-if" if="[[_replies.length]]">
                        <template is="dom-repeat" items="[[_replies]]">
                            <reply-card reply="[[item]]"></reply-card>
                        </template>
                    </template>

                </div>
            </div>

            <!-- REPLIES -->
            <div name="history">
                <steem-get-history id="steemGetHistory"
                                   user-name="[[_accountName]]"
                                   events="{{_events}}">
                </steem-get-history>
                <div id="events-list">

                    <template is="dom-if" if="[[!_events.length]]">
                        <h1 class="nothingText">[[userName]] has no history</h1>
                    </template>

                    <template is="dom-if" if="[[_events.length]]">
                        <!--iron-scroll-threshold  on-lower-threshold="_loadMoreHistoryEvents"> This is triggered before _events are loaded :/-->
                        <template is="dom-repeat" items="[[_events]]">
                            <event-card event="[[item]]"></event-card>
                        </template>
                        <!--/iron-scroll-threshold-->
                    </template>

                </div>
            </div>

            <!-- SHARED FILES -->
            <div name="files">

                <div id="file-list">
                    <template is="dom-repeat" items="[[_account.sharedFiles]]">
                        <file-card file="[[item]]"
                                   action="{{_actionFile}}"
                                   allow-select="false">
                        </file-card>
                    </template>
                </div>

            </div>

            <!-- SHARED ARTICLES -->
            <div name="articles">

                <div id="categoryList">
                    <template is="dom-repeat" items="[[_account.sharedCategories]]">
                        <paper-button on-tap="_setArticlesQuery()">[[item.name]]</paper-button>
                    </template>
                </div>

                <div id="article-list">
                    <template is="dom-repeat"
                              items="[[_account.sharedArticles]]"
                              filter="{{_computeArticleFilter(_articlesQuery)}}">
                        <article-card article="[[item]]"
                                   action="{{_actionArticle}}"
                                   allow-select="false">
                        </article-card>
                    </template>
                </div>

            </div>

            <!-- FOLLOWER -->
            <div name="followers">

                <div id="followers-list">

                    <template is="dom-if" if="[[!_followers.length]]">
                        <h1 class="nothingText">[[userName]] has no follower</h1>
                    </template>

                    <template is="dom-if" if="[[_followers.length]]">
                        <template is="dom-repeat" items="[[_followers]]">
                            <user-card user="[[item]]"></user-card>
                        </template>
                    </template>

                </div>
            </div>

            <!-- FOLLOWING -->
            <div name="following">

                <div id="following-list">
                    <template is="dom-if" if="[[!_following.length]]">
                        <h1 class="nothingText">[[userName]] is not following anyone</h1>
                    </template>

                    <template is="dom-if" if="[[_following.length]]">
                        <template is="dom-repeat" items="[[_following]]">
                            <user-card user="[[item]]"></user-card>
                        </template>
                    </template>

                </div>
            </div>
        </iron-pages>

        <paper-fab id="openWalletButton"
                   on-tap="_openWallet()"
                   icon="my-icons:wallet">
        </paper-fab>

    </template>
</dom-module>

<script>

    Polymer({

        is: 'page-profile',

        properties: {

            settings: {
                type: Object
            },

            userName: {
                type: String
            },

            _showProgress: {
                type: Boolean
            },

            _account: {
                type: Object
            },

            _posts: {
                type: Array
            },

            _replies: {
                type: Array
            },

            _currentProfileView: {
                type: String
            },

            _currentAboutView: {
                type: String
            },

            _accountName: {
                type: String,
                notify: true
            },

            _followCount: {
                type: Object
            },

            _followers: {
                type: Array
            },

            _following: {
                type: Array
            },

            _events: {
                type: Array
            },

            _currentFile: {
                type: Object
            },

            _actionFile: {
                type: Object
            },

            _currentArticle: {
                type: Object
            },

            _actionArticle: {
                type: Object
            },

            _isUserInFavorite: {
                type: Boolean
            },

            _isTabAbout: {
                type: Boolean
            },

            _pinnedPost: {
                type: Object
            },

            _articlesQuery: {
                type: String
            }
        },

        observers: [
            '_updateCoverImage(_account.coverImage)',
            '_userChanged(userName)',
            '_refreshIsTabAbout(_currentProfileView)',
            '_setTabsOptions(_account.tabsOptions)',
            '_setTabFileStyle(_account.sharedFiles.length)',
            '_setTabArticleStyle(_account.sharedArticles.length)',
            '_doFileAction(_actionFile.type, _actionFile.id)',
            '_doArticleAction(_actionArticle.type, _actionArticle.id)'
        ],

        listeners: {
            'aboutMenu.tap': '_selectAboutView',
            'categoryList.tap': '_setArticlesQuery'
        },

        ready: function() {

            // Set variables
            this._currentProfileView = 'about';
            this._currentAboutView = 'home';
            this._accountName = '';

            this._actionFile = {};
            this._currentFile = {};
            this._articlesQuery = '';

            this._actionArticle = {};
            this._currentArticle = {};

            // List event
            this.$.toggleDrawerMenu.addEventListener('tap', this._openDrawer.bind(this));
            this.$.openWalletButton.addEventListener('tap', this._openWallet.bind(this));
            this.$.followersButton.addEventListener('tap', this._setCurrentViewFollowers.bind(this));
            this.$.followingButton.addEventListener('tap', this._setCurrentViewFollowing.bind(this));
            this.$.toggleFavoriteUserButton.addEventListener('tap', this._toggleFavoriteUser.bind(this));
        },

        _userChanged: function(userName) {

            /*
            * /@piskel -> /@esteem8 = OK
            * /@esteem8 or an other account -> /@piskel or an other account = freeze
            *
            */

            if(userName.includes('@')) {

                // Reset account related data
                this.set('_posts', []);
                this.set('_events', []);
                this.set('_replies', []);
                this.set('_followers', []);
                this.set('_following', []);
                this.set('_sharedFiles', []);
                this.set('_sharedArticles', []);
                this.set('_articlesQuery', '');

                // Reset view position
                this._currentProfileView = 'about';
                this._currentAboutView = 'home';

                // Reload page
                /*
                 * Reload account data won't
                 */

                // Remove '@' at user and put it into _accountName
                this._accountName = userName.replace('@', '');

                this._refreshIsFavoriteUser();
            }
        },

        _setTabFileStyle: function(fileLength) {

            if(fileLength) {

                this.$.tabFiles.setAttribute('style', '');
            }else {

                this.$.tabFiles.setAttribute('style', 'display: none;');
            }
        },

        _doFileAction: function(type, id) {

            switch(type) {

                case 'view':
                    this._openViewFile(id);
            }
        },

        _openViewFile: function(id) {

            // Get file from id
            for(var i = 0; i < this._account.sharedFiles.length; i++) {

                if(this._account.sharedFiles[i].id == id) {

                    // Set file object from index
                    this.set('_currentFile', this._account.sharedFiles[i]);

                    // Open dialog
                    this.$.viewFileDialog.open();
                }
            }

        },

        _setTabArticleStyle: function(articleLength) {

            if(articleLength) {

                this.$.tabArticles.setAttribute('style', '');
            }else {

                this.$.tabArticles.setAttribute('style', 'display: none;');
            }
        },

        _doArticleAction: function(type, id) {

            switch(type) {

                case 'view':
                    this._openViewArticle(id);
            }
        },

        _openViewArticle: function(id) {

            // Get file from id
            for(var i = 0; i < this._account.sharedArticles.length; i++) {

                if(this._account.sharedArticles[i].id == id) {

                    // Set file object from index
                    this.set('_currentArticle', this._account.sharedArticles[i]);

                    // Open dialog
                    this.$.viewArticleDialog.open();
                }
            }

        },

        _setArticlesQuery: function(e) {

            this._articlesQuery = e.model.item.name;
        },

        _setTabsOptions: function(tabsOptions) {

            if(typeof tabsOptions !== 'undefined') {

                if(tabsOptions != '') {

                    // ABOUT

                    // POSTS

                    // COMMENTS

                    // REPLIES
                    if(typeof tabsOptions.replies !== 'undefined') {

                        if(typeof tabsOptions.replies.display !== 'undefined') {

                            if(tabsOptions.replies.display == 'none') {

                                this.$.tabReplies.setAttribute('style', 'display: none;')

                            }

                        }else {

                            this.$.tabReplies.setAttribute('style', '')
                        }

                    }else {

                        this.$.tabReplies.setAttribute('style', '')
                    }

                    // HISTORY
                    if(typeof tabsOptions.history !== 'undefined') {

                        if(typeof tabsOptions.history.display !== 'undefined') {

                            if(tabsOptions.history.display == 'none') {

                                this.$.tabHistory.setAttribute('style', 'display: none;')

                            }

                        }else {

                            this.$.tabHistory.setAttribute('style', '')
                        }

                    }else {

                        this.$.tabHistory.setAttribute('style', '')
                    }

                }

                }

        },

        _openDrawer: function() {

            document.getElementById('appshell')._openDrawer();
        },

        _openWallet: function() {

            this.$.wallet.open();
        },

        _updateCoverImage: function(url) {

            if(url !== ''){

                this.$.profileheader.style.backgroundImage = "url('" + url + "')";
            }else {

                this.$.profileheader.style.backgroundImage = "";
            }

        },

        _selectAboutView: function(e) {

            if(typeof e.path[0] !== 'undefined') {

                if(typeof e.path[0].view !== 'undefined') {

                    this._currentAboutView = e.path[0].view;
                    return;
                }
            }

            this._currentAboutView = "home";

        },

        _setCurrentViewFollowers: function() {

            this.set('_currentProfileView', 'followers');
        },

        _setCurrentViewFollowing: function() {

            this.set('_currentProfileView', 'following')
        },

        _setCurrentViewPosts: function() {

            this.set('_currentProfileView', 'posts');
        },

        _refreshIsFavoriteUser: function() {

            this._isUserInFavorite = document.getElementById('appshell').isFavoriteUser(this._accountName);
        },

        _toggleFavoriteUser: function() {

            if(this._isUserInFavorite) {

                // Remove user from favourite
                document.getElementById('appshell').removeFavoriteUser(this._accountName);
            }else {

                // Add user to favourite
                document.getElementById('appshell').addFavoriteUser(this._accountName);
            }

            // Invert favorite state of user
            this._refreshIsFavoriteUser();
        },

        _computeFavoriteUserIcon: function(userIsInFavorite) {

            return userIsInFavorite ?
                    'favorite':
                    'favorite-border';
        },

        _refreshIsTabAbout: function(currentProfileView) {

            this._isTabAbout = currentProfileView == 'about' ? true: false;
        },

        _getPostTitleFromPath: function(postPath) {

            var pathSplitted = postPath.split('/');

            var postTitle = pathSplitted[pathSplitted.length-1];
            var postTitleText = postTitle.split('-').join(' ');
            postTitleText = this._capitalizeFirstLetter(postTitleText);

            return postTitleText;
        },

        _capitalizeFirstLetter: function(string) {

            return string.charAt(0).toUpperCase() + string.slice(1);
        },

        /* ARTICLE SEARCH (FILTER) */

        _computeArticleFilter: function(string) {
            if (!string) {
                // set filter to null to disable filtering
                return null;
            } else {

                // return a filter function for the current search string
                string = string.toLowerCase();

                return function(item) {

                    // Set variables
                    var statement = false;
                    var articleName = item.name.toLowerCase();

                    var keys = string.split(' ');
                    var keysLength = keys.length;

                    var tags = [];

                    if(typeof item.tags !== 'undefined') {

                        tags = item.tags;
                    }

                    var tagsLength = tags.length;


                    /*
                     *
                     *      Tag can contain anything exept "," and ", "
                     *      Tag are separated by "," or ", "
                     *
                     */

                    /* If mutliples key, restrictive filter (image + esteem8 = not only image but image with esteem8) */

                    /*
                     * This function search on tags and name,
                     * the queryString is composed of multiples keywords
                     * Only one keyword can be used to search on name, but the keyword can be in the middle of the array
                     */

                    if(keysLength == 1) { // One keyword in string

                        /*
                         * The keyword need to be equals to a tag or contained in name
                         */

                        // First keyword
                        if(articleName.includes(keys[0].replace(/\-/gm, ' '))) { // String part of the name

                            statement = true;
                        }

                        for(var i = 0; i < tagsLength; i++) { // String equal to a tag

                            var tag = tags[i].toLowerCase();

                            if(tag == keys[0]) {
                                statement = true;
                            }
                        }
                    }else {

                        /*
                         * All first keyword need to be equals to a tag
                         * The last keyword of the keyword set need to be equals to a tag or contained in the name
                         */

                        var allFirstKeywordMatch = true;

                        // All first keyword
                        for(var i = 0; i < keysLength-1; i++) { // For all keyword

                            var key = keys[i];

                            var keyXYStatement = false;

                            for(var j = 0; j < tagsLength; j++) { // keyword equal to a tag

                                var tag = tags[j].toLowerCase();

                                if(tag == key) {
                                    keyXYStatement = true;
                                }
                            }

                            if(!keyXYStatement) {

                                allFirstKeywordMatch = false;
                            }

                        }

                        var lastKeywordOfTheListMatch = false;
                        var lastKeywordOfTheList = keys[keysLength-1].replace(/\-/gm, ' ');

                        for(var i = 0; i < tagsLength; i++) { // String equal to a tag

                            var tag = tags[i].toLowerCase();

                            if(tag == lastKeywordOfTheList) {
                                lastKeywordOfTheListMatch = true;
                            }
                        }

                        if(articleName.includes(lastKeywordOfTheList)) { // String part of the name

                            lastKeywordOfTheListMatch = true;
                        }

                        if(lastKeywordOfTheListMatch && allFirstKeywordMatch) {

                            statement = true;
                        }

                    }

                    return statement;
                };
            }
        }

        /*
         * IDEAS
         * Pin other element or element in post
         */

    });
</script>